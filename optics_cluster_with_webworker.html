<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>OPTICS-Clustering-Algo with WebWorker</title>

<script src="libs/random_points.js" type="text/javascript"></script>
<script src="libs/birth_and_death_rate.js" type="text/javascript"></script>
<script src="libs/optics.js" type="text/javascript"></script>
<script type="text/javascript">
  
  var clusteringAlgo = null;
  var selectedDataset = 'birth_and_death_rate';
  var indexNumber = 'lowest_reachability';
  
  window.onload = function(){
    
    document.getElementById('clusterButton').onclick = function(event){
      
      document.getElementById('progress_bar').value = '0';
      
      var main_webworker = new Worker('libs/main_webworker.js')
      
      main_webworker.onmessage = function(event){ // when main webworker returned message it has finished calculating optimal parameters(epsilon,minPts)
        
        var data = event.data;
        
        if(data.progress_level){
          document.getElementById('progress_bar').value = data.progress_level;
          return;
        }
        
        main_webworker.terminate();
        
        visualizeResult(data.e, data.minPts);
      };
      
      var dataToSend = {};
      
      /* which dataset should be analysed? */
      if(selectedDataset === 'birth_and_death_rate')
        dataToSend.dataset = birth_and_death_rate;
      else
        dataToSend.dataset = random_points;
      
      /* which index-number should be used? */
      dataToSend.indexNumber = 'lowest_reachability';
      
      main_webworker.postMessage(dataToSend);
      
    };
    
    function visualizeResult(epsilon, minPts){
      
      if(selectedDataset === 'birth_and_death_rate')
        clusteringAlgo = new OPTICS(birth_and_death_rate);
      else
        clusteringAlgo = new OPTICS(random_points);
        
      var output = clusteringAlgo.start(epsilon,minPts);
      
      img = clusteringAlgo.draw2DPlot(output,1000,1000);
      document.body.appendChild(img);
      
      img = clusteringAlgo.drawBarChartPlot(output, epsilon, minPts, 3000, 1000);
      document.body.appendChild(img);
        
    }
    
    document.getElementById('terminateWorkerButton').onclick = function(event){
      if(typeof main_webworker !== 'undefined')
        main_webworker.terminate();
    };
    
  };
  
  function changeDataset(obj){
    selectedDataset = obj.value;
  }
  
  function changeIndexNumber(obj){
    indexNumber = obj.value;
  }
  
</script>
</head>

<body>
<h2>This app is made for searching optimal parameter-values for OPTICS</h2>
<h2>Choose dataset and index-number and press determine</h2>
<h2 id="result"></h2>
<table>
  <form>
    <select onchange="changeDataset(this)">
      <option value="birth_and_death_rate" selected>Birth and Death Rat of Countries</option>
      <option value="random_points">Random Points on ground</option>
    </select>
    <select onchange="changeIndexNumber(this)">
      <option value="symmetric">Symmetric Index-Number</option>
      <option value="lowest_reachability" selected>Lowest-Reachability Index-Number</option>
    </select>
    <tr><td>Worker's finished:<progress value="0" max="1" id="progress_bar"></progress></td></tr>
    <tr>
      <td>
        <input type="button" id="clusterButton" value="determine"/>
        <input type="button" id="terminateWorkerButton" value="terminate Worker" />
      </td>
    </tr>
    
  </form>
</table>
</body>
</html>
